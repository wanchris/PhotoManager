package photo_renamer;

import static org.junit.Assert.*;

import java.io.File;
import java.io.IOException;
import java.io.PrintWriter;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.ArrayList;
import java.util.List;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;

public class TagTest {
	//Create instances that the entire class can share.
	/** Tag variables to be used in testing */
	private Tag tagTestOne, tagTestTwo, tagtestthree, temptag;
	/** String variables to be used in testing */
	private String name1, name2, name3, change1, change2, change3; 
	/** Result of the list of tags, called by .getTags() */
	private List<String> tagsActual; 
	/** Expected list of tags during testing */
	private List<String> tagsExpected;	
	/** Store the current directory of file */
	private String currentDirectory;
	/** Path to a file to write to or read from */
	private String path; 
	/** File to write to or read from */
	private File f; 
	/** The method initialize to pull from Tag class */
	private Method initialize; 
	
	@Before
	public void SetUp() throws NoSuchMethodException, SecurityException, NoSuchFieldException{
		// Set these values in this method so that every test case can
        // begin with them in this state, even if previous test cases
        // have changed them.
		tagsActual = Tag.getTags(); //Create an instance to store the Tag List generated by the subclass
		tagsExpected = new ArrayList<String>(); //Create an instance to store the expected value of tags
		currentDirectory = System.getProperty("user.dir"); 
		
		name1 = "One";
		name2 = "Two";
		name3 = "Three"; 
		
		change1 = "1"; 
		change2 = "2"; 
		change3 = "3";
		
		//gain access to the initialize method from Tag class 
		initialize = Tag.class.getDeclaredMethod("initialize");
		initialize.setAccessible(true);
	}
	
	/**
	 * Test getting the tags when there are no tags.             
	 */	
	@Test
	public void testGetNoTags() {
		assertEquals(tagsExpected, tagsActual);
	}
	
	/**
	 * Test getting the tags when there is one tag.             
	 */	
	@Test
	public void testGetOneTag() throws ClassNotFoundException, IOException {
		tagTestOne = new Tag("One"); //Create a new tag named One
		//Add the tag values 
		tagsExpected.add("One");
		
		assertEquals(tagsExpected, tagsActual);			
	}	
	
	/**
	 * Test getting the tags when there are multiple tags.             
	 */	
	@Test
	public void testGetMultipleTags() throws ClassNotFoundException, IOException {
		//The tagsActual variable stores the result the getTags() method. Test for all true/false.
		tagTestOne = new Tag("One"); //Create a new tag named One
		tagTestTwo = new Tag("Two"); //Create a new tag named Two
		tagtestthree = new Tag("Three"); //Create a new tag named Three
		//Add the tag values 
		tagsExpected.add("One");
		tagsExpected.add("Two"); 
		tagsExpected.add("Three"); 
		
		assertEquals(tagsExpected, tagsActual); 
	}
	
	/**
	 * Test loading and saving tags when there are no tags.             
	 */	
	@Test
	public void testLoadAndSaveNoTags() throws ClassNotFoundException, IOException {
		//testing both load and save functions in one test 
		path = currentDirectory + "\\" + "none.txt";	
		
		f = new File(path);
		f.createNewFile(); 
		
		Tag.saveTags(path);
		Tag.removeTags();
		assertTrue(tagsActual.isEmpty()); 
		
		Tag.loadTags(path);
		
		assertEquals(tagsExpected, tagsActual); 
	}
	
	/**
	 * Test loading and saving tags when there is one tag.             
	 */	
	@Test
	public void testLoadAndSaveOneTag() throws ClassNotFoundException, IOException {
		//testing both load and save functions in one test 
		path = currentDirectory + "\\" + "one.txt";	
		
		f = new File(path);
		f.createNewFile(); 
		
		tagTestOne = new Tag("One"); //Create a new tag named One		
		
		Tag.saveTags(path);
		//Add the tag values 
		tagsExpected.add("One");
		
		Tag.removeTags();
		assertTrue(tagsActual.isEmpty()); 
		
		Tag.loadTags(path);
		assertEquals(tagsExpected, tagsActual); 
	}
	
	/**
	 * Test loading and saving tags when there are multiple tags.             
	 */	
	@Test
	public void testLoadAndSaveMultipleTags() throws ClassNotFoundException, IOException {
		//testing both load and save functions in one test 
		path = currentDirectory + "\\" + "multiple.txt";	
		f = new File(path);
		f.createNewFile(); 
		
		tagTestOne = new Tag("One"); //Create a new tag named One
		tagTestTwo = new Tag("Two"); //Create a new tag named Two
		tagtestthree = new Tag("Three"); //Create a new tag named Three
		
		Tag.saveTags(path);
		//Add the tag values 
		tagsExpected.add("One");
		tagsExpected.add("Two"); 
		tagsExpected.add("Three"); 	
		
		Tag.removeTags();
		assertTrue(tagsActual.isEmpty()); 
		
		Tag.loadTags(path);
		
		assertEquals(tagsExpected, tagsActual); 
	}
	
	/**
	 * Test getName() for three different tags.             
	 */
	@Test
	public void testGetName() throws ClassNotFoundException, IOException { 
		tagTestOne = new Tag("One"); //Create a new tag named One
		tagTestTwo = new Tag("Two"); //Create a new tag named Two
		tagtestthree = new Tag("Three"); //Create a new tag named Three
		assertEquals(name1, tagTestOne.getName());
		assertEquals(name2, tagTestTwo.getName());
		assertEquals(name3, tagtestthree.getName());
	}
	
	/**
	 * Test setName() for three different tags.             
	 */
	@Test
	public void testSetName() throws ClassNotFoundException, IOException { 
		//test for the first constructor 
		tagTestOne = new Tag("One"); //Create a new tag named One
		tagTestTwo = new Tag("Two"); //Create a new tag named Two
		tagtestthree = new Tag("Three"); //Create a new tag named Three
		//Change the names of all 3 tags. 
		tagTestOne.setName("1");
		tagTestTwo.setName("2");
		tagtestthree.setName("3"); 
		
		assertEquals(change1, tagTestOne.getName());
		assertEquals(change2, tagTestTwo.getName());
		assertEquals(change3, tagtestthree.getName());		
	}	
	
	/**
	 * Test to ensure that tags with the same name are not recorded as different tags         
	 */
	@Test 
	public void testDoubleTags() throws ClassNotFoundException, IOException { 
		tagTestOne = new Tag("One"); //Create a new tag named One
		tagTestTwo = new Tag("One"); //Try to create an additional tag named One 
		//Add the tag values 
		tagsExpected.add("One"); //Tags should only display "One" once 
		
		assertEquals(tagsExpected, tagsActual); 
	}
	
	/**
	 * Test removal of tags with no tags.            
	 */
	@Test
	public void testRemoveNoTags() throws ClassNotFoundException, IOException { 
		Tag.removeTags();
		assertTrue(tagsActual.isEmpty()); //Check to make sure the tags list is empty
	}
	
	/**
	 * Test removal of tags with one tag.            
	 */
	@Test 
	public void testRemoveOneTag() throws ClassNotFoundException, IOException { 
		//Do not load from the master tag file in case other tests have modified.
		tagTestOne = new Tag("One"); //Create a new tag named One		
				
		Tag.removeTags();
		assertTrue(tagsActual.isEmpty()); //Check to make sure the tags list is empty		
	}
	
	/**
	 * Test removal of tags with multiple tags.            
	 */
	@Test 
	public void testRemoveMultipleTags() throws ClassNotFoundException, IOException { 
		//Do not load from the master tag file in case other tests have modified.
		tagTestOne = new Tag("One"); //Create a new tag named One
		tagTestTwo = new Tag("Two"); //Create a new tag named Two
		tagtestthree = new Tag("Three"); //Create a new tag named Three		
		
		Tag.removeTags();
		assertTrue(tagsActual.isEmpty()); //Check to make sure the tags list is empty	
	}
	
	/**
	 * Test initialization of tags with no tags.            
	 */
	@Test 
	public void testInitializeNoTags() throws ClassNotFoundException, IOException, IllegalAccessException, IllegalArgumentException, InvocationTargetException { 
		//Write a file with the same path as the masterlist that contains no tags.  
		List<String> toWrite = new ArrayList<String>(); 
		
		temptag = new Tag("temp"); //create a temporary instance to use for the pulled method
		Tag.removeTags(); //remove the instance from the list
		assertTrue(Tag.getTags().isEmpty());
		
		//empty the masterlist
		path = currentDirectory + "\\" + Tag.FILENAME;
		f = new File(path); 
		
		/** Writer to write to file */
		PrintWriter writer = new PrintWriter(f); 
	    for (String toAdd: toWrite) {
	    	writer.println(toAdd); 
	    }
	    writer.close();
	    
	    initialize.invoke(temptag); 	    
	    
	    assertEquals(tagsExpected, tagsActual); 	 
	}
	
	/**
	 * Test initialization of tags with one tag.            
	 */
	@Test 
	public void testInitializeOneTag() throws ClassNotFoundException, IOException, IllegalAccessException, IllegalArgumentException, InvocationTargetException { 
		//Write a file with the same path as the masterlist that contains one tag - One. 
		List<String> toWrite = new ArrayList<String>(); 
		toWrite.add("One");
		
		temptag = new Tag("temp"); //create a temporary instance to use for the pulled method
		Tag.removeTags(); //remove the instance from the list
		assertTrue(Tag.getTags().isEmpty());
		
		//empty the masterlist
		path = currentDirectory + "\\" + Tag.FILENAME;
		f = new File(path); 
		
		/** Writer to write to file */
		PrintWriter writer = new PrintWriter(f); 
	    for (String toAdd: toWrite) {
	    	writer.println(toAdd); 
	    }
	    writer.close();
	    
	    initialize.invoke(temptag); 
	    
	    //Add the tag values 
	    tagsExpected.add("One");
	    
	    assertEquals(tagsExpected, tagsActual); 	    
	}
	
	/**
	 * Test initialization of tags with multiple tags.            
	 */
	@Test 
	public void testInitializeMultipleTags() throws ClassNotFoundException, IOException, IllegalAccessException, IllegalArgumentException, InvocationTargetException { 
		//Write a file with the same path as the masterlist that contains three tags - One, Two, Three. 
		List<String> toWrite = new ArrayList<String>(); 
		toWrite.add("One");
		toWrite.add("Two"); 
		toWrite.add("Three"); 
		
		temptag = new Tag("temp"); //create a temporary instance to use for the pulled method
		Tag.removeTags(); //remove the instance from the list
		assertTrue(Tag.getTags().isEmpty());
		
		//empty the masterlist
		path = currentDirectory + "\\" + Tag.FILENAME;
		f = new File(path); 
		
		/** Writer to write to file */
		PrintWriter writer = new PrintWriter(f); 
	    for (String toAdd: toWrite) {
	    	writer.println(toAdd); 
	    }
	    writer.close();
	    
	    initialize.invoke(temptag); 
	    
	    //Add the tag values 
	    tagsExpected.add("One");
	    tagsExpected.add("Two"); 
	    tagsExpected.add("Three"); 	
	    
	    assertEquals(tagsExpected, tagsActual); 	    
	}
	
	@After
	public void TearDown() throws Exception{
		//Reset all values to default null. 
		tagsActual = null; 
		assertNull(tagsActual); 
		tagsExpected = null;
		assertNull(tagsExpected);	
		tagTestOne = null; 
		assertNull(tagTestOne);
		tagTestTwo = null; 
		assertNull(tagTestTwo);
		tagtestthree = null; 
		assertNull(tagtestthree);
		
		Tag.removeTags(); //Reset the tags	
		assertTrue(Tag.getTags().isEmpty());
		
		//clear the masterlist if it has been written to
		List<String> toWrite = new ArrayList<String>(); 
		
		path = currentDirectory + "\\" + Tag.FILENAME;
		f = new File(path); 
		
		/** Writer to write to file */
		PrintWriter writer = new PrintWriter(f); 
	    for (String toAdd: toWrite) {
	    	writer.println(toAdd); 
	    }
	    writer.close();
	}
		
	
}


